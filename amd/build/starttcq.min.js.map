{"version":3,"file":"starttcq.min.js","sources":["../src/starttcq.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Allows the teacher to start tcquiz\n * Note that the $(\"#page-content\") of the quiz view page is replaced by $(\"#starttcquizform\")\n *\n * @module     quizaccess_tcquiz\n * @copyright  2024 Capilano University\n * @author     Tamara Dakic <tdakic@capilanou.ca>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Notification from 'core/notification';\nimport {get_string as getString} from 'core/str';\n\nconst Selectors = {\n    actions: {\n        startTCQButton: '[data-action=\"quizaccess_tcquiz/starttcq-startnew_button\"]',\n        endButton: '[data-action=\"quizaccess_tcquiz/starttcq-end_button\"]',\n        rejoinButton: '[data-action=\"quizaccess_tcquiz/starttcq-rejoin_button\"]',\n    },\n\n};\n\nconst registerEventListeners = (sessionid, joincode, timestamp, currentpage, status, attemptid, existingsession, quizid, cmid) => {\n\n\n    //trying to prevent double clicking here\n    document.addEventListener('click', (e) => {\n          if (e.target.closest(Selectors.actions.startTCQButton)) {\n            e.preventDefault();\n    }},{once: true});\n\n\n    document.addEventListener('click', async(e) => {\n          if (e.target.closest(Selectors.actions.endButton)) {\n            e.preventDefault();\n\n            var url = M.cfg.wwwroot+\"/mod/quiz/accessrule/tcquiz/end_session.php?id=\"+ e.target.name + \"&cmid=\" + cmid;\n\n            //response.status will be 404 even if the fetched url throws exception\n            await fetch(url, {method: \"POST\",}).then((response) => {\n                  if (!response.ok) {\n                    Notification.addNotification({\n                        message: getString('errorclosingsession', 'quizaccess_tcquiz'),\n                        type: 'error'\n                    });\n                  }\n                  else {\n                    location.reload();\n                  }\n          });\n    }},{once: true});\n\n    document.addEventListener('click', async(e) => {\n          if (e.target.closest(Selectors.actions.rejoinButton)) {\n            e.preventDefault();\n            //constants defined in tcq_constants.json - get them!\n            const response = await fetch(M.cfg.wwwroot+\"/mod/quiz/accessrule/tcquiz/tcq_constants.json\");\n            const tcq_consts = await response.json();\n\n            var url = \"\";\n            if (status == tcq_consts.TCQUIZ_STATUS_READYTOSTART){\n              url = M.cfg.wwwroot+\"/mod/quiz/accessrule/tcquiz/wait_for_students.php?quizid=\"+ quizid + \"&cmid=\" + cmid +\n              \"&attemptid=\" + attemptid + \"&joincode=\" + joincode + \"&sessionid=\" + sessionid+\"&sesskey=\"+ M.cfg.sesskey;\n              window.location.replace(url);\n            }\n            else if (status == tcq_consts.TCQUIZ_STATUS_PREVIEWQUESTION || status == tcq_consts.TCQUIZ_STATUS_SHOWQUESTION){\n              url = M.cfg.wwwroot+\"/mod/quiz/accessrule/tcquiz/attempt.php?showall=0&quizid=\"+ quizid + \"&cmid=\" + cmid +\n              \"&attempt=\" + attemptid + \"&joincode\" + joincode + \"&sessionid=\" + sessionid + \"&page=\" + currentpage +\n              \"&sesskey=\"+ M.cfg.sesskey;\n              window.location.replace(url);\n            }\n            else if (status == tcq_consts.TCQUIZ_STATUS_SHOWRESULTS){\n              url = M.cfg.wwwroot+\"/mod/quiz/accessrule/tcquiz/review_tcq.php?showall=false&quizid=\"+ quizid + \"&cmid=\" + cmid +\n              \"&attempt=\" + attemptid + \"&joincode\" + joincode + \"&sessionid=\" + sessionid + \"&page=\" + currentpage +\n              \"&sesskey=\"+ M.cfg.sesskey;\n              window.location.replace(url);\n            }\n            else if (status == tcq_consts.TCQUIZ_STATUS_FINALRESULTS){\n              //tcquiz_get_final_results();\n              url = M.cfg.wwwroot+\"/mod/quiz/accessrule/tcquiz/report_final_results.php?mode=overview&quizid=\"+ quizid +\n              \"&id=\" + cmid + \"&tcqsid=\" + sessionid + \"&sesskey=\"+ M.cfg.sesskey;\n              window.location.replace(url);\n            }\n            else{\n              Notification.addNotification({\n                  message: getString('errorrejoining', 'quizaccess_tcquiz'),\n                  type: 'error'\n              });\n            }\n          }\n    },{once: true});\n\n\n  window.addEventListener('load', function(){\n\n      $(\"#page-content\").html($(\"#starttcquizform\"));\n\n    });\n\n};\n\nexport const init = (sessionid, joincode, timestamp, currentpage, status, attemptid, existingsession, quizid, cmid) => {\n\n  registerEventListeners(sessionid, joincode, timestamp, currentpage, status, attemptid, existingsession, quizid, cmid);\n\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","_jquery","_notification","Selectors","startTCQButton","endButton","rejoinButton","_exports","init","sessionid","joincode","timestamp","currentpage","status","attemptid","existingsession","quizid","cmid","registerEventListeners","document","addEventListener","e","target","closest","preventDefault","once","async","url","M","cfg","wwwroot","name","fetch","method","then","response","ok","location","reload","Notification","addNotification","message","getString","type","tcq_consts","json","TCQUIZ_STATUS_READYTOSTART","sesskey","window","replace","TCQUIZ_STATUS_PREVIEWQUESTION","TCQUIZ_STATUS_SHOWQUESTION","TCQUIZ_STATUS_SHOWRESULTS","TCQUIZ_STATUS_FINALRESULTS","$","html"],"mappings":"uIA0B6C,SAAAA,uBAAAC,YAAAA,KAAAA,IAAAC,WAAAD,KAAAE,QAAAF;;;;;;;;;kFAD7CG,QAAAJ,uBAAAI,SACAC,cAAAL,uBAAAK,eAGA,MAAMC,kBACO,CACLC,eAAgB,6DAChBC,UAAW,wDACXC,aAAc,4DAwFpBC,SAAAC,KAJkBA,CAACC,UAAWC,SAAUC,UAAWC,YAAaC,OAAQC,UAAWC,gBAAiBC,OAAQC,QA/E/EC,EAACT,UAAWC,SAAUC,UAAWC,YAAaC,OAAQC,UAAWC,gBAAiBC,OAAQC,QAIrHE,SAASC,iBAAiB,SAAUC,IAC1BA,EAAEC,OAAOC,QAAQpB,kBAAkBC,iBACrCiB,EAAEG,mBACP,CAACC,MAAM,IAGVN,SAASC,iBAAiB,SAASM,UAC7B,GAAIL,EAAEC,OAAOC,QAAQpB,kBAAkBE,WAAY,CACjDgB,EAAEG,iBAEF,IAAIG,IAAMC,EAAEC,IAAIC,QAAQ,kDAAmDT,EAAEC,OAAOS,KAAO,SAAWd,WAGhGe,MAAML,IAAK,CAACM,OAAQ,SAAUC,MAAMC,WAC/BA,SAASC,GAOZC,SAASC,SANTC,sBAAaC,gBAAgB,CACzBC,SAAS,EAAAC,iBAAU,sBAAuB,qBAC1CC,KAAM,gBAOvB,CAAClB,MAAM,IAEVN,SAASC,iBAAiB,SAASM,UAC7B,GAAIL,EAAEC,OAAOC,QAAQpB,kBAAkBG,cAAe,CACpDe,EAAEG,iBAEF,MAAMW,eAAiBH,MAAMJ,EAAEC,IAAIC,QAAQ,kDACrCc,iBAAmBT,SAASU,OAElC,IAAIlB,IAAM,GACNd,QAAU+B,WAAWE,4BACvBnB,IAAMC,EAAEC,IAAIC,QAAQ,4DAA6Dd,OAAS,SAAWC,KACrG,cAAgBH,UAAY,aAAeJ,SAAW,cAAgBD,UAAU,YAAamB,EAAEC,IAAIkB,QACnGC,OAAOX,SAASY,QAAQtB,MAEjBd,QAAU+B,WAAWM,+BAAiCrC,QAAU+B,WAAWO,4BAClFxB,IAAMC,EAAEC,IAAIC,QAAQ,4DAA6Dd,OAAS,SAAWC,KACrG,YAAcH,UAAY,YAAcJ,SAAW,cAAgBD,UAAY,SAAWG,YAC1F,YAAagB,EAAEC,IAAIkB,QACnBC,OAAOX,SAASY,QAAQtB,MAEjBd,QAAU+B,WAAWQ,2BAC5BzB,IAAMC,EAAEC,IAAIC,QAAQ,mEAAoEd,OAAS,SAAWC,KAC5G,YAAcH,UAAY,YAAcJ,SAAW,cAAgBD,UAAY,SAAWG,YAC1F,YAAagB,EAAEC,IAAIkB,QACnBC,OAAOX,SAASY,QAAQtB,MAEjBd,QAAU+B,WAAWS,4BAE5B1B,IAAMC,EAAEC,IAAIC,QAAQ,6EAA8Ed,OAClG,OAASC,KAAO,WAAaR,UAAY,YAAamB,EAAEC,IAAIkB,QAC5DC,OAAOX,SAASY,QAAQtB,MAGxBY,sBAAaC,gBAAgB,CACzBC,SAAS,EAAAC,iBAAU,iBAAkB,qBACrCC,KAAM,aAIlB,CAAClB,MAAM,IAGXuB,OAAO5B,iBAAiB,QAAQ,YAE5B,EAAAkC,iBAAE,iBAAiBC,MAAK,EAAAD,iBAAE,uBAE1B,EAMJpC,CAAuBT,UAAWC,SAAUC,EAAWC,YAAaC,OAAQC,UAAWC,EAAiBC,OAAQC,KAAK,CAErH"}