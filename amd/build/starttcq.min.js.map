{"version":3,"file":"starttcq.min.js","sources":["../src/starttcq.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Allows the teacher to start tcquiz\n * Note that the $(\"#page-content\") of the quiz view page is replaced by $(\"#starttcquizform\")\n *\n * The actual form for typing in the new joincode and starting a new quiz is in\n * /mod/quiz/accessrule/tcquiz/classes/form/tcq_start_form.php\n * and is validated by the validation method\n *\n * @module     quizaccess_tcquiz\n * @copyright  2024 Capilano University\n * @author     Tamara Dakic <tdakic@capilanou.ca>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Notification from 'core/notification';\nimport {get_string as getString} from 'core/str';\n\nconst Selectors = {\n    actions: {\n        startTCQButton: '[data-action=\"quizaccess_tcquiz/starttcq-startnew_button\"]',\n        endButton: '[data-action=\"quizaccess_tcquiz/starttcq-end_button\"]',\n        rejoinButton: '[data-action=\"quizaccess_tcquiz/starttcq-rejoin_button\"]',\n    },\n\n};\n\nconst registerEventListeners = (sessionid, joincode, timestamp, currentpage, status, attemptid, existingsession, quizid, cmid) => {\n\n    window.addEventListener('load', function(){\n\n        $(\"#page-content\").html($(\"#starttcquizform\"));\n\n      });\n\n\n    //handle the teacher clicking on the End button to end the session\n    const endTCQAction = document.querySelector(Selectors.actions.endButton);\n    endTCQAction.addEventListener('click', async(e) => {\n\n            e.preventDefault();\n\n            var url = M.cfg.wwwroot+\"/mod/quiz/accessrule/tcquiz/end_session.php?id=\"+ e.target.name + \"&cmid=\" + cmid;\n\n            //response.status will be 404 even if the fetched url throws exception\n            await fetch(url, {method: \"POST\",}).then((response) => {\n                  if (!response.ok) {\n                    Notification.addNotification({\n                        message: getString('errorclosingsession', 'quizaccess_tcquiz'),\n                        type: 'error'\n                    });\n                  }\n                  else {\n                    location.reload();\n                  }\n          });\n    },{once: true});\n\n    //handle the teacher clicking on the Rejoin button to rejoin the running session\n    const rejoinTCQAction = document.querySelector(Selectors.actions.rejoinButton);\n    rejoinTCQAction.addEventListener('click', async(e) => {\n            e.preventDefault();\n            //constants defined in tcq_constants.json - get them!\n            const response = await fetch(M.cfg.wwwroot+\"/mod/quiz/accessrule/tcquiz/tcq_constants.json\");\n            const tcq_consts = await response.json();\n\n            var url = \"\";\n            if (status == tcq_consts.TCQUIZ_STATUS_READYTOSTART){\n              url = M.cfg.wwwroot+\"/mod/quiz/accessrule/tcquiz/wait_for_students.php?quizid=\"+ quizid + \"&cmid=\" + cmid +\n              \"&attemptid=\" + attemptid + \"&joincode=\" + joincode + \"&sessionid=\" + sessionid+\"&sesskey=\"+ M.cfg.sesskey;\n              window.location.replace(url);\n            }\n            else if (status == tcq_consts.TCQUIZ_STATUS_PREVIEWQUESTION || status == tcq_consts.TCQUIZ_STATUS_SHOWQUESTION){\n              url = M.cfg.wwwroot+\"/mod/quiz/accessrule/tcquiz/attempt.php?showall=0&quizid=\"+ quizid + \"&cmid=\" + cmid +\n              \"&attempt=\" + attemptid + \"&joincode\" + joincode + \"&sessionid=\" + sessionid + \"&page=\" + currentpage +\n              \"&sesskey=\"+ M.cfg.sesskey;\n              window.location.replace(url);\n            }\n            else if (status == tcq_consts.TCQUIZ_STATUS_SHOWRESULTS){\n              url = M.cfg.wwwroot+\"/mod/quiz/accessrule/tcquiz/review_tcq.php?showall=false&quizid=\"+ quizid + \"&cmid=\" + cmid +\n              \"&attempt=\" + attemptid + \"&joincode\" + joincode + \"&sessionid=\" + sessionid + \"&page=\" + currentpage +\n              \"&sesskey=\"+ M.cfg.sesskey;\n              window.location.replace(url);\n            }\n            else if (status == tcq_consts.TCQUIZ_STATUS_FINALRESULTS){\n              //tcquiz_get_final_results();\n              url = M.cfg.wwwroot+\"/mod/quiz/accessrule/tcquiz/report_final_results.php?mode=overview&quizid=\"+ quizid +\n              \"&id=\" + cmid + \"&tcqsid=\" + sessionid + \"&sesskey=\"+ M.cfg.sesskey;\n              window.location.replace(url);\n            }\n            else{\n              Notification.addNotification({\n                  message: getString('errorrejoining', 'quizaccess_tcquiz'),\n                  type: 'error'\n              });\n            }\n    },{once: true});\n\n\n    //trying to prevent double clicking here\n    document.addEventListener('click', (e) => {\n          if (e.target.closest(Selectors.actions.startTCQButton)) {\n            e.preventDefault();\n    }},{once: true});\n\n};\n\nexport const init = (sessionid, joincode, timestamp, currentpage, status, attemptid, existingsession, quizid, cmid) => {\n\n  registerEventListeners(sessionid, joincode, timestamp, currentpage, status, attemptid, existingsession, quizid, cmid);\n\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","_jquery","_notification","Selectors","startTCQButton","endButton","rejoinButton","_exports","init","sessionid","joincode","timestamp","currentpage","status","attemptid","existingsession","quizid","cmid","registerEventListeners","window","addEventListener","$","html","document","querySelector","async","e","preventDefault","url","M","cfg","wwwroot","target","name","fetch","method","then","response","ok","location","reload","Notification","addNotification","message","getString","type","once","tcq_consts","json","TCQUIZ_STATUS_READYTOSTART","sesskey","replace","TCQUIZ_STATUS_PREVIEWQUESTION","TCQUIZ_STATUS_SHOWQUESTION","TCQUIZ_STATUS_SHOWRESULTS","TCQUIZ_STATUS_FINALRESULTS","closest"],"mappings":"uIA8B6C,SAAAA,uBAAAC,YAAAA,KAAAA,IAAAC,WAAAD,KAAAE,QAAAF;;;;;;;;;;;;;kFAD7CG,QAAAJ,uBAAAI,SACAC,cAAAL,uBAAAK,eAGA,MAAMC,kBACO,CACLC,eAAgB,6DAChBC,UAAW,wDACXC,aAAc,4DAyFpBC,SAAAC,KAJkBA,CAACC,UAAWC,SAAUC,UAAWC,YAAaC,OAAQC,UAAWC,gBAAiBC,OAAQC,QAhF/EC,EAACT,UAAWC,SAAUC,UAAWC,YAAaC,OAAQC,UAAWC,gBAAiBC,OAAQC,QAErHE,OAAOC,iBAAiB,QAAQ,YAE5B,EAAAC,iBAAE,iBAAiBC,MAAK,EAAAD,iBAAE,wBAMTE,SAASC,cAAcrB,kBAAkBE,WACjDe,iBAAiB,SAASK,UAE/BC,EAAEC,iBAEF,IAAIC,IAAMC,EAAEC,IAAIC,QAAQ,kDAAmDL,EAAEM,OAAOC,KAAO,SAAWhB,WAGhGiB,MAAMN,IAAK,CAACO,OAAQ,SAAUC,MAAMC,WAC/BA,SAASC,GAOZC,SAASC,SANTC,sBAAaC,gBAAgB,CACzBC,SAAS,EAAAC,iBAAU,sBAAuB,qBAC1CC,KAAM,YAMlB,GACN,CAACC,MAAM,IAGevB,SAASC,cAAcrB,kBAAkBG,cACjDc,iBAAiB,SAASK,UAClCC,EAAEC,iBAEF,MAAMU,eAAiBH,MAAML,EAAEC,IAAIC,QAAQ,kDACrCgB,iBAAmBV,SAASW,OAElC,IAAIpB,IAAM,GACNf,QAAUkC,WAAWE,4BACvBrB,IAAMC,EAAEC,IAAIC,QAAQ,4DAA6Df,OAAS,SAAWC,KACrG,cAAgBH,UAAY,aAAeJ,SAAW,cAAgBD,UAAU,YAAaoB,EAAEC,IAAIoB,QACnG/B,OAAOoB,SAASY,QAAQvB,MAEjBf,QAAUkC,WAAWK,+BAAiCvC,QAAUkC,WAAWM,4BAClFzB,IAAMC,EAAEC,IAAIC,QAAQ,4DAA6Df,OAAS,SAAWC,KACrG,YAAcH,UAAY,YAAcJ,SAAW,cAAgBD,UAAY,SAAWG,YAC1F,YAAaiB,EAAEC,IAAIoB,QACnB/B,OAAOoB,SAASY,QAAQvB,MAEjBf,QAAUkC,WAAWO,2BAC5B1B,IAAMC,EAAEC,IAAIC,QAAQ,mEAAoEf,OAAS,SAAWC,KAC5G,YAAcH,UAAY,YAAcJ,SAAW,cAAgBD,UAAY,SAAWG,YAC1F,YAAaiB,EAAEC,IAAIoB,QACnB/B,OAAOoB,SAASY,QAAQvB,MAEjBf,QAAUkC,WAAWQ,4BAE5B3B,IAAMC,EAAEC,IAAIC,QAAQ,6EAA8Ef,OAClG,OAASC,KAAO,WAAaR,UAAY,YAAaoB,EAAEC,IAAIoB,QAC5D/B,OAAOoB,SAASY,QAAQvB,MAGxBa,sBAAaC,gBAAgB,CACzBC,SAAS,EAAAC,iBAAU,iBAAkB,qBACrCC,KAAM,YAGlB,CAACC,MAAM,IAITvB,SAASH,iBAAiB,SAAUM,IAC1BA,EAAEM,OAAOwB,QAAQrD,kBAAkBC,iBACrCsB,EAAEC,mBACP,CAACmB,MAAM,GAAM,EAMlB5B,CAAuBT,UAAWC,SAAUC,EAAWC,YAAaC,OAAQC,UAAWC,EAAiBC,OAAQC,KAAK,CAErH"}